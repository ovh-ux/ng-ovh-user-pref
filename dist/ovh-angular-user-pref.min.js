/*! ovh-angular-user-pref - 0.3.1 - 2017-07-04 */
angular.module("ovh-angular-user-pref",["ovh-angular-proxy-request"]),angular.module("ovh-angular-user-pref").constant("OVH_USER_PREF",{path:{get:"me/preferences/manager",getKey:"me/preferences/manager/{key}",create:"me/preferences/manager",assign:"me/preferences/manager",remove:"me/preferences/manager/{key}"}}),angular.module("ovh-angular-user-pref").provider("ovhUserPref",function(){"use strict";function a(a){return a?a.replace(/\/+$/g,""):a}function b(a){return d.regex.test(a)}var c=this,d={apiv6Path:null,regex:null};c.paramsInjector=function(a,b,c){var d=b||{};return[c||"",a.replace(/\{([^\}]+)\}/,function(a,b){return encodeURIComponent(d[b]||"")})].join("/")};var e={};c.setRegex=function(a){d.regex=a},c.setApiv6Path=function(b){d.apiv6Path=a(b)},c.$get=["ovh-proxy-request.proxy","$q","OVH_USER_PREF",function(f,g,h){var i={};return d.apiv6Path=d.apiv6Path||a(f.pathPrefix()),d.regex=d.regex||/^[A-Z]+_[A-Z][A-Z0-9]*(?:_[A-Z0-9]*)*$/,i.getKeys=function(a){var b=_.assign(a||{},{serviceType:"apiv6"});return f.get(c.paramsInjector(h.path.get,null,d.apiv6Path),b).then(function(a){return a?a.data:[]})},i.getValue=function(a,b){var e=_.assign(b||{},{serviceType:"apiv6"});return f.get(c.paramsInjector(h.path.getKey,{key:a},d.apiv6Path),e).then(function(a){try{return angular.fromJson(a.data.value)}catch(b){return g.reject({status:404})}})},i.create=function(a,i){if(!b(a))return g.reject("Invalid format key");var j=g.defer();return a in e&&e[a].resolve(),e[a]=j,f.post(c.paramsInjector(h.path.create,null,d.apiv6Path),{key:a,value:angular.toJson(i)},{serviceType:"apiv6",timeout:j.promise}).then(function(a){return a?a.data:a}).finally(function(){e[a]===j&&delete e[a]})},i.assign=function(a,e){return b(a)?i.getValue(a).then(function(b){return f.post(c.paramsInjector(h.path.assign,null,d.apiv6Path),{key:a,value:angular.toJson(_.assign(b,e))},{serviceType:"apiv6"})},function(b){return b&&404===b.status?f.post(c.paramsInjector(h.path.create,null,d.apiv6Path),{key:a,value:angular.toJson(e)},{serviceType:"apiv6"}):g.reject(b)}).then(function(a){return a?a.data:a}):g.reject("Invalid format key")},i.remove=function(a){return b(a)?(a in e&&(e[a].resolve(),delete e[a]),f.delete(c.paramsInjector(h.path.remove,{key:a},d.apiv6Path),{serviceType:"apiv6"}).then(function(a){return a?a.data:a})):g.reject("Invalid format key")},i}]});